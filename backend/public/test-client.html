<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Socket.IO quick test</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
      body { font: 14px/1.4 system-ui, sans-serif; padding: 12px }
      input, button { padding: 6px 10px; margin: 4px }
      #log { white-space: pre-wrap; background:#111; color:#0f0; padding:10px; min-height:120px }
    </style>
  </head>
  <body>
    <h3>SocketIO quick test</h3>

    <div>
      <button id="btnCreate">Create room</button>
      <input id="room" placeholder="ROOM ID" />
      <input id="name" placeholder="Your name" value="Guest" />
      <button id="btnJoin">Join room</button>
    </div>

    <div>
      <input id="msg" placeholder="message…" value="hello from browser" />
      <button id="btnSend">Send</button>
    </div>

    <pre id="log"></pre>

    <script>
      const log = (...args) => {
        const pre = document.getElementById('log');
        pre.textContent += args.map(a => (typeof a === 'string' ? a : JSON.stringify(a))).join(' ') + '\n';
        pre.scrollTop = pre.scrollHeight;
      };

      const socket = io("http://localhost:5000", { transports: ["websocket"] });

      // ---- server events
      socket.on("connect", () => log("connected:", socket.id));
      socket.on("connected", (d) => log("server:", d));

      socket.on("room_created", (d) => {
        log("room_created:", d);
        document.getElementById('room').value = d.room_id;
      });
      socket.on("room_joined", (d) => log("room_joined:", d));
      socket.on("player_joined", (d) => log("player_joined:", d));
      socket.on("player_left", (d) => log("player_left:", d));
      socket.on("room_players", (d) => log("room_players:", d));
      socket.on("chat_message", (d) => log("chat_message:", d));
      socket.on("canvas_update", (d) => log("canvas_update:", d));
      socket.on("error", (e) => log("ERROR:", e));

      // ---- UI handlers
      document.getElementById('btnCreate').onclick = () => {
        const name = document.getElementById('name').value || "Host";
        socket.emit('create_room', { player_name: name });
      };

      document.getElementById('btnJoin').onclick = () => {
        const name = document.getElementById('name').value || "Guest";
        const room = document.getElementById('room').value.trim();
        socket.emit('join_room', { room_id: room, player_name: name });
      };

      document.getElementById('btnSend').onclick = () => {
        const text = document.getElementById('msg').value;
        socket.emit('send_message', { message: text });
      };

      // (bonus) thử vài event vẽ tay từ console:
      // socket.emit('drawing_start', {x:10,y:10})
      // socket.emit('drawing_move',  {x:40,y:40})
      // socket.emit('drawing_end',   {})
    </script>
  </body>
</html>
